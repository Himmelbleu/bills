import{D as t,C as e}from"./index-H7sj-gKN.js";import{U as h}from"./index-C8DKE861.js";import{d as E,h as x,m as I,A as M,c as V,g as a,b as l,w as i,u as m,a as _,o as F,e as b}from"./index-B-RKLB6a.js";const R={class:"mb-4"},G=a("div",{class:"mb-4"},[a("div",null,"设置"),a("div",{class:"text-0.8rem text-text-secondary"},"一些设置和管理")],-1),S={class:"flex-wrap f-c-b"},T={class:"f-c-c flex-basis-33.33% max-w-33.33%"},Y={class:"f-c-c flex-basis-33.33% max-w-33.33%"},U=a("div",{class:"mb-4"},[a("div",null,"选项"),a("div",{class:"text-0.8rem text-text-secondary"},"配置预算、图表")],-1),K=E({__name:"Settings",async setup(j){let c,f;const o=([c,f]=x(()=>t.create()),c=await c,f(),c),B=([c,f]=x(()=>t.get(o,e.DB_CONFIG,e.DB_KEY_CONFIG)),c=await c,f(),c);async function O(){const d=await t.get(o,e.DB_RECORD),s=await t.get(o,e.DB_COMMENTS,e.DB_KEY_COMMENTS),n=await t.get(o,e.DB_CONFIG,e.DB_KEY_CONFIG),u=new Blob([JSON.stringify([{records:d,comments:s,config:n}])],{type:"text/json"}),p=document.createElement("a"),D=h.Dates.formatDate("YY-MM-DD-hh-mm-ss");p.download=`${D}.json`,p.href=URL.createObjectURL(u),p.click()}const N=async d=>{if(d.raw){const s=new FileReader;s.readAsText(d.raw),s.onload=()=>{const n=JSON.parse(s.result.toString());t.clear(o,e.DB_RECORD).then(()=>{n[0].records.forEach(u=>{t.leadIn(o,u,e.DB_RECORD)})}),t.clear(o,e.DB_COMMENTS).then(()=>{t.leadIn(o,n[0].comments,e.DB_COMMENTS)}),t.clear(o,e.DB_CONFIG).then(()=>{t.leadIn(o,n[0].config,e.DB_CONFIG)})}}};async function g(){await t.del(e.DB_TALLYPAD)}const r=I({...B});return M(r,(d,s,n)=>{t.put(o,e.DB_CONFIG,h.Objects.raw(d),e.DB_KEY_CONFIG)}),(d,s)=>{const n=_("el-button"),u=_("el-upload"),p=_("el-popconfirm"),D=_("el-input"),w=_("el-form-item"),v=_("el-switch"),y=_("el-form");return F(),V("div",null,[a("div",R,[G,a("div",S,[a("div",T,[l(n,{plain:"",round:"",type:"primary",onClick:O},{default:i(()=>[b("导出数据")]),_:1})]),l(u,{"auto-upload":!1,limit:1,"on-change":N,"show-file-list":!1,accept:"application/json",class:"f-c-c flex-basis-33.33% max-w-33.33%"},{default:i(()=>[l(n,{plain:"",round:"",type:"success"},{default:i(()=>[b("导入数据")]),_:1})]),_:1}),a("div",Y,[l(p,{title:"确定清除数据？",onConfirm:g},{reference:i(()=>[l(n,{plain:"",round:"",type:"danger"},{default:i(()=>[b("清除数据")]),_:1})]),_:1})])])]),a("div",null,[U,a("div",null,[l(y,{model:m(r),class:"p-4","label-position":"left","label-width":"auto"},{default:i(()=>[l(w,{label:"总预算"},{default:i(()=>[l(D,{modelValue:m(r).budget,"onUpdate:modelValue":s[0]||(s[0]=C=>m(r).budget=C),size:"small",type:"number"},null,8,["modelValue"])]),_:1}),l(w,{label:m(r).isChart?"开启图表":"关闭图表"},{default:i(()=>[l(v,{modelValue:m(r).isChart,"onUpdate:modelValue":s[1]||(s[1]=C=>m(r).isChart=C)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model"])])])])}}});export{K as default};
