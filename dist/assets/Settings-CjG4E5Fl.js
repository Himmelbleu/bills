import{D as t,C as e}from"./index-BQ4MH4yd.js";import{U as B}from"./index-yN6PRDud.js";import{d as E,g as h,l as V,z as I,c as M,f as s,b as o,w as i,u as d,a as m,o as F,e as w}from"./index-D6eo5SNi.js";const R={class:"mb-4"},G=s("div",{class:"mb-4"},[s("div",null,"设置"),s("div",{class:"text-0.8rem text-text-secondary"},"一些设置和管理")],-1),S={class:"flex-wrap f-c-b"},A={class:"f-c-c flex-basis-33.33% max-w-33.33%"},T={class:"f-c-c flex-basis-33.33% max-w-33.33%"},U=s("div",{class:"mb-4"},[s("div",null,"选项"),s("div",{class:"text-0.8rem text-text-secondary"},"配置预算、图表")],-1),K=E({__name:"Settings",async setup(Y){let r,b;const l=([r,b]=h(()=>t.create()),r=await r,b(),r),O=([r,b]=h(()=>t.get(l,e.DB_CONFIG,e.DB_KEY_CONFIG)),r=await r,b(),r);async function N(){const _=await t.get(l,e.DB_RECORD),a=await t.get(l,e.DB_COMMENTS,e.DB_KEY_COMMENTS),c=await t.get(l,e.DB_CONFIG,e.DB_KEY_CONFIG),u=new Blob([JSON.stringify([{records:_,comments:a,config:c}])],{type:"text/json"}),p=document.createElement("a"),D=B.Dates.formatDate("YY-MM-DD-hh-mm-ss");p.download=`${D}.json`,p.href=URL.createObjectURL(u),p.click()}const g=async _=>{if(_.raw){const a=new FileReader;a.readAsText(_.raw),a.onload=()=>{const c=JSON.parse(a.result.toString());t.clear(l,e.DB_RECORD).then(()=>{c[0].records.forEach(u=>{t.leadIn(l,u,e.DB_RECORD)})}),t.clear(l,e.DB_COMMENTS).then(()=>{t.leadIn(l,c[0].comments,e.DB_COMMENTS)}),t.clear(l,e.DB_CONFIG).then(()=>{t.leadIn(l,c[0].config,e.DB_CONFIG)})}}};async function v(){await t.del(e.DB_TALLYPAD)}const n=V({...O});return I(n,_=>{t.put(l,e.DB_CONFIG,B.Objects.raw(_),e.DB_KEY_CONFIG)}),(_,a)=>{const c=m("el-button"),u=m("el-upload"),p=m("el-popconfirm"),D=m("el-input"),C=m("el-form-item"),x=m("el-switch"),y=m("el-form");return F(),M("div",null,[s("div",R,[G,s("div",S,[s("div",A,[o(c,{plain:"",round:"",type:"primary",onClick:N},{default:i(()=>[w("导出数据")]),_:1})]),o(u,{"auto-upload":!1,limit:1,"on-change":g,"show-file-list":!1,accept:"application/json",class:"f-c-c flex-basis-33.33% max-w-33.33%"},{default:i(()=>[o(c,{plain:"",round:"",type:"success"},{default:i(()=>[w("导入数据")]),_:1})]),_:1}),s("div",T,[o(p,{title:"确定清除数据？",onConfirm:v},{reference:i(()=>[o(c,{plain:"",round:"",type:"danger"},{default:i(()=>[w("清除数据")]),_:1})]),_:1})])])]),s("div",null,[U,s("div",null,[o(y,{model:d(n),class:"p-4","label-position":"left","label-width":"auto"},{default:i(()=>[o(C,{label:"预算"},{default:i(()=>[o(D,{modelValue:d(n).budget,"onUpdate:modelValue":a[0]||(a[0]=f=>d(n).budget=f),size:"small",type:"number"},null,8,["modelValue"])]),_:1}),o(C,{label:d(n).isChart?"开启图表":"关闭图表"},{default:i(()=>[o(x,{modelValue:d(n).isChart,"onUpdate:modelValue":a[1]||(a[1]=f=>d(n).isChart=f)},null,8,["modelValue"])]),_:1},8,["label"]),o(C,{label:d(n).itemAsc?"计划项升序":"计划项降序"},{default:i(()=>[o(x,{modelValue:d(n).itemAsc,"onUpdate:modelValue":a[2]||(a[2]=f=>d(n).itemAsc=f)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model"])])])])}}});export{K as default};
