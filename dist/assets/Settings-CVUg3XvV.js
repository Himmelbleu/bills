import{D as a,C as e}from"./index-BxJgwICe.js";import{U as h}from"./index-C8DKE861.js";import{d as E,h as B,m as V,A as I,c as M,g as l,b as o,w as i,u as d,a as m,o as F,e as w}from"./index-Du4agYfN.js";const R={class:"mb-4"},A=l("div",{class:"mb-4"},[l("div",null,"设置"),l("div",{class:"text-0.8rem text-text-secondary"},"一些设置和管理")],-1),G={class:"flex-wrap f-c-b"},S={class:"f-c-c flex-basis-33.33% max-w-33.33%"},T={class:"f-c-c flex-basis-33.33% max-w-33.33%"},U=l("div",{class:"mb-4"},[l("div",null,"选项"),l("div",{class:"text-0.8rem text-text-secondary"},"配置预算、图表")],-1),K=E({__name:"Settings",async setup(Y){let r,b;const s=([r,b]=B(()=>a.create()),r=await r,b(),r),O=([r,b]=B(()=>a.get(s,e.DB_CONFIG,e.DB_KEY_CONFIG)),r=await r,b(),r);async function N(){const _=await a.get(s,e.DB_RECORD),t=await a.get(s,e.DB_COMMENTS,e.DB_KEY_COMMENTS),c=await a.get(s,e.DB_CONFIG,e.DB_KEY_CONFIG),u=new Blob([JSON.stringify([{records:_,comments:t,config:c}])],{type:"text/json"}),p=document.createElement("a"),D=h.Dates.formatDate("YY-MM-DD-hh-mm-ss");p.download=`${D}.json`,p.href=URL.createObjectURL(u),p.click()}const g=async _=>{if(_.raw){const t=new FileReader;t.readAsText(_.raw),t.onload=()=>{const c=JSON.parse(t.result.toString());a.clear(s,e.DB_RECORD).then(()=>{c[0].records.forEach(u=>{a.leadIn(s,u,e.DB_RECORD)})}),a.clear(s,e.DB_COMMENTS).then(()=>{a.leadIn(s,c[0].comments,e.DB_COMMENTS)}),a.clear(s,e.DB_CONFIG).then(()=>{a.leadIn(s,c[0].config,e.DB_CONFIG)})}}};async function v(){await a.del(e.DB_TALLYPAD)}const n=V({...O});return I(n,(_,t,c)=>{a.put(s,e.DB_CONFIG,h.Objects.raw(_),e.DB_KEY_CONFIG)}),(_,t)=>{const c=m("el-button"),u=m("el-upload"),p=m("el-popconfirm"),D=m("el-input"),C=m("el-form-item"),x=m("el-switch"),y=m("el-form");return F(),M("div",null,[l("div",R,[A,l("div",G,[l("div",S,[o(c,{plain:"",round:"",type:"primary",onClick:N},{default:i(()=>[w("导出数据")]),_:1})]),o(u,{"auto-upload":!1,limit:1,"on-change":g,"show-file-list":!1,accept:"application/json",class:"f-c-c flex-basis-33.33% max-w-33.33%"},{default:i(()=>[o(c,{plain:"",round:"",type:"success"},{default:i(()=>[w("导入数据")]),_:1})]),_:1}),l("div",T,[o(p,{title:"确定清除数据？",onConfirm:v},{reference:i(()=>[o(c,{plain:"",round:"",type:"danger"},{default:i(()=>[w("清除数据")]),_:1})]),_:1})])])]),l("div",null,[U,l("div",null,[o(y,{model:d(n),class:"p-4","label-position":"left","label-width":"auto"},{default:i(()=>[o(C,{label:"总预算"},{default:i(()=>[o(D,{modelValue:d(n).budget,"onUpdate:modelValue":t[0]||(t[0]=f=>d(n).budget=f),size:"small",type:"number"},null,8,["modelValue"])]),_:1}),o(C,{label:d(n).isChart?"开启图表":"关闭图表"},{default:i(()=>[o(x,{modelValue:d(n).isChart,"onUpdate:modelValue":t[1]||(t[1]=f=>d(n).isChart=f)},null,8,["modelValue"])]),_:1},8,["label"]),o(C,{label:d(n).itemAsc?"收支升序":"收支降序"},{default:i(()=>[o(x,{modelValue:d(n).itemAsc,"onUpdate:modelValue":t[2]||(t[2]=f=>d(n).itemAsc=f)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model"])])])])}}});export{K as default};
